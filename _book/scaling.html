<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Supplement to Shiny in Production</title>
  <meta name="description" content="This document is full of supplemental resources and content from the Shiny in Production Workshop delievered at rstudio::conf 2019.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Supplement to Shiny in Production" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This document is full of supplemental resources and content from the Shiny in Production Workshop delievered at rstudio::conf 2019." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Supplement to Shiny in Production" />
  
  <meta name="twitter:description" content="This document is full of supplemental resources and content from the Shiny in Production Workshop delievered at rstudio::conf 2019." />
  



<meta name="date" content="2019-01-14">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="plot-caching.html">
<link rel="next" href="alternatives-to-shiny.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />










<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">rstudio::conf 2019</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Shiny in Production Workshop</a></li>
<li class="chapter" data-level="2" data-path="course-intro.html"><a href="course-intro.html"><i class="fa fa-check"></i><b>2</b> Introduction to Shiny in Production</a><ul>
<li class="chapter" data-level="2.1" data-path="course-intro.html"><a href="course-intro.html#workshop-objectives"><i class="fa fa-check"></i><b>2.1</b> Workshop Objectives</a></li>
<li class="chapter" data-level="2.2" data-path="course-intro.html"><a href="course-intro.html#workshop-infrastructure"><i class="fa fa-check"></i><b>2.2</b> Workshop Infrastructure</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="app-intro.html"><a href="app-intro.html"><i class="fa fa-check"></i><b>3</b> Introduction to the Application</a><ul>
<li class="chapter" data-level="3.1" data-path="app-intro.html"><a href="app-intro.html#activity-explore-the-application"><i class="fa fa-check"></i><b>3.1</b> Activity: Explore the Application</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="application-testing-shinytest.html"><a href="application-testing-shinytest.html"><i class="fa fa-check"></i><b>4</b> Application Testing: <code>shinytest</code></a><ul>
<li class="chapter" data-level="4.1" data-path="application-testing-shinytest.html"><a href="application-testing-shinytest.html#testing-options"><i class="fa fa-check"></i><b>4.1</b> Testing Options</a></li>
<li class="chapter" data-level="4.2" data-path="application-testing-shinytest.html"><a href="application-testing-shinytest.html#activity-shinytest"><i class="fa fa-check"></i><b>4.2</b> Activity: <code>shinytest</code></a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="profiling-the-most-important-thing.html"><a href="profiling-the-most-important-thing.html"><i class="fa fa-check"></i><b>5</b> Profiling: “The most important thing”</a><ul>
<li class="chapter" data-level="5.1" data-path="profiling-the-most-important-thing.html"><a href="profiling-the-most-important-thing.html#activity-profiling"><i class="fa fa-check"></i><b>5.1</b> Activity: Profiling</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="deployment.html"><a href="deployment.html"><i class="fa fa-check"></i><b>6</b> Deployment</a><ul>
<li class="chapter" data-level="6.1" data-path="deployment.html"><a href="deployment.html#rstudio-connect"><i class="fa fa-check"></i><b>6.1</b> RStudio Connect</a></li>
<li class="chapter" data-level="6.2" data-path="deployment.html"><a href="deployment.html#activity-inital-deployment"><i class="fa fa-check"></i><b>6.2</b> Activity: Inital Deployment</a></li>
<li class="chapter" data-level="6.3" data-path="deployment.html"><a href="deployment.html#application-settings"><i class="fa fa-check"></i><b>6.3</b> Application Settings</a><ul>
<li class="chapter" data-level="6.3.1" data-path="deployment.html"><a href="deployment.html#access"><i class="fa fa-check"></i><b>6.3.1</b> Access</a></li>
<li class="chapter" data-level="6.3.2" data-path="deployment.html"><a href="deployment.html#metadata"><i class="fa fa-check"></i><b>6.3.2</b> Metadata</a></li>
<li class="chapter" data-level="6.3.3" data-path="deployment.html"><a href="deployment.html#logs"><i class="fa fa-check"></i><b>6.3.3</b> Logs</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="connecting-to-data-in-production.html"><a href="connecting-to-data-in-production.html"><i class="fa fa-check"></i><b>7</b> Connecting to Data in Production</a><ul>
<li class="chapter" data-level="7.1" data-path="connecting-to-data-in-production.html"><a href="connecting-to-data-in-production.html#the-config-package"><i class="fa fa-check"></i><b>7.1</b> The <code>config</code> package</a></li>
<li class="chapter" data-level="7.2" data-path="connecting-to-data-in-production.html"><a href="connecting-to-data-in-production.html#environment-variables"><i class="fa fa-check"></i><b>7.2</b> Environment Variables</a></li>
<li class="chapter" data-level="7.3" data-path="connecting-to-data-in-production.html"><a href="connecting-to-data-in-production.html#activity-databases"><i class="fa fa-check"></i><b>7.3</b> Activity: Databases</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="load-testing.html"><a href="load-testing.html"><i class="fa fa-check"></i><b>8</b> Load Testing</a><ul>
<li class="chapter" data-level="8.1" data-path="load-testing.html"><a href="load-testing.html#optimization-loop-methodology"><i class="fa fa-check"></i><b>8.1</b> Optimization Loop Methodology</a></li>
<li class="chapter" data-level="8.2" data-path="load-testing.html"><a href="load-testing.html#activity-load-testing"><i class="fa fa-check"></i><b>8.2</b> Activity: Load Testing</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="plot-caching.html"><a href="plot-caching.html"><i class="fa fa-check"></i><b>9</b> Plot Caching</a><ul>
<li class="chapter" data-level="9.1" data-path="plot-caching.html"><a href="plot-caching.html#when-to-use-plot-caching"><i class="fa fa-check"></i><b>9.1</b> When to use plot caching</a><ul>
<li class="chapter" data-level="9.1.1" data-path="plot-caching.html"><a href="plot-caching.html#using-rendercachedplot"><i class="fa fa-check"></i><b>9.1.1</b> Using <code>renderCachedPlot</code></a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="plot-caching.html"><a href="plot-caching.html#activity-plot-cache-benchmarking"><i class="fa fa-check"></i><b>9.2</b> Activity: Plot cache benchmarking</a></li>
<li class="chapter" data-level="9.3" data-path="plot-caching.html"><a href="plot-caching.html#extended-topics"><i class="fa fa-check"></i><b>9.3</b> Extended Topics</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="scaling.html"><a href="scaling.html"><i class="fa fa-check"></i><b>10</b> Scaling</a><ul>
<li class="chapter" data-level="10.1" data-path="scaling.html"><a href="scaling.html#rstudio-connect-performance-settings"><i class="fa fa-check"></i><b>10.1</b> RStudio Connect Performance Settings</a><ul>
<li class="chapter" data-level="10.1.1" data-path="scaling.html"><a href="scaling.html#content-scheduler"><i class="fa fa-check"></i><b>10.1.1</b> Content Scheduler</a></li>
<li class="chapter" data-level="10.1.2" data-path="scaling.html"><a href="scaling.html#scheduling-parameters"><i class="fa fa-check"></i><b>10.1.2</b> Scheduling Parameters</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="scaling.html"><a href="scaling.html#activity-runtime-settings"><i class="fa fa-check"></i><b>10.2</b> Activity: Runtime Settings</a></li>
<li class="chapter" data-level="10.3" data-path="scaling.html"><a href="scaling.html#activity-admin-dashboard"><i class="fa fa-check"></i><b>10.3</b> Activity: Admin Dashboard</a></li>
<li class="chapter" data-level="10.4" data-path="scaling.html"><a href="scaling.html#extended-topics-1"><i class="fa fa-check"></i><b>10.4</b> Extended Topics</a><ul>
<li class="chapter" data-level="10.4.1" data-path="scaling.html"><a href="scaling.html#high-availability-and-horizontal-scaling"><i class="fa fa-check"></i><b>10.4.1</b> High Availability and Horizontal Scaling</a></li>
<li class="chapter" data-level="10.4.2" data-path="scaling.html"><a href="scaling.html#r-markdown-documents-with-runtimeshiny"><i class="fa fa-check"></i><b>10.4.2</b> R Markdown Documents with runtime::shiny</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="alternatives-to-shiny.html"><a href="alternatives-to-shiny.html"><i class="fa fa-check"></i><b>11</b> Alternatives to Shiny</a><ul>
<li class="chapter" data-level="11.1" data-path="alternatives-to-shiny.html"><a href="alternatives-to-shiny.html#plumber"><i class="fa fa-check"></i><b>11.1</b> Plumber</a><ul>
<li class="chapter" data-level="11.1.1" data-path="alternatives-to-shiny.html"><a href="alternatives-to-shiny.html#intro-to-plumber"><i class="fa fa-check"></i><b>11.1.1</b> Intro to Plumber</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="alternatives-to-shiny.html"><a href="alternatives-to-shiny.html#activity-plumber"><i class="fa fa-check"></i><b>11.2</b> Activity: Plumber</a></li>
<li class="chapter" data-level="11.3" data-path="alternatives-to-shiny.html"><a href="alternatives-to-shiny.html#r-markdown"><i class="fa fa-check"></i><b>11.3</b> R Markdown</a></li>
<li class="chapter" data-level="11.4" data-path="alternatives-to-shiny.html"><a href="alternatives-to-shiny.html#activity-r-markdown"><i class="fa fa-check"></i><b>11.4</b> Activity: R Markdown</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="devops-philosophy-tooling.html"><a href="devops-philosophy-tooling.html"><i class="fa fa-check"></i><b>12</b> DevOps Philosophy &amp; Tooling</a></li>
<li class="chapter" data-level="13" data-path="production-case-studies.html"><a href="production-case-studies.html"><i class="fa fa-check"></i><b>13</b> Production Case Studies</a><ul>
<li class="chapter" data-level="13.1" data-path="production-case-studies.html"><a href="production-case-studies.html#case-study-a-devtestprod"><i class="fa fa-check"></i><b>13.1</b> Case Study A: Dev/Test/Prod</a></li>
<li class="chapter" data-level="13.2" data-path="production-case-studies.html"><a href="production-case-studies.html#case-study-b-ci-git-chef"><i class="fa fa-check"></i><b>13.2</b> Case Study B: CI, Git, Chef</a></li>
<li class="chapter" data-level="13.3" data-path="production-case-studies.html"><a href="production-case-studies.html#case-study-c-docker"><i class="fa fa-check"></i><b>13.3</b> Case Study C: Docker</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="shiny-async.html"><a href="shiny-async.html"><i class="fa fa-check"></i><b>14</b> Shiny Async</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Supplement to Shiny in Production</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="scaling" class="section level1">
<h1><span class="header-section-number">Chapter 10</span> Scaling</h1>
<p><strong>Application Scaling 101</strong></p>
<div class="figure">
<img src="imgs/scaling/kitchen-scaling.png" alt="Kitchen Scaling" />
<p class="caption">Kitchen Scaling</p>
</div>
<div id="rstudio-connect-performance-settings" class="section level2">
<h2><span class="header-section-number">10.1</span> RStudio Connect Performance Settings</h2>
<p><strong>Scaling and Performance Tuning in RStudio Connect</strong></p>
<ul>
<li><a href="https://support.rstudio.com/hc/en-us/articles/231874748-scaling-and-performance-tuning-rstudio-connect">Article Reference</a></li>
</ul>
<p>RStudio Connect is built to scale content. Publishers and administrators have access to runtime settings to help tune and scale their applications and APIs. The primary concern for scaling content in RStudio Connect is understanding when and how R code will be executed on the server.</p>
<p>Content published on RStudio Connect can broadly fall into two categories:</p>
<ol style="list-style-type: decimal">
<li>Static / Batch Content</li>
</ol>
<p>Static content is content a user can visit without requiring a running process. Examples include PDF documents, plots, and HTML files. HTML files can include interactive elements where the interactivity occurs on the client. RStudio Connect is able to update static content on a schedule.</p>
<ol start="2" style="list-style-type: decimal">
<li>Interactive Content</li>
</ol>
<p>A powerful component of RStudio Connect is the ability to host data products that require backend processes during a user’s visit. Examples include shiny applications and R Markdown documents with runtime::shiny, plumber APIs, and TensorFlow APIs. In the case of Shiny, an end user’s browser (the client) is connected with an R process running on the server. When a user changes an input, the client sends a message to the server and a portion of R code is re-run. The server sends back the result as output. In the case of APIs, a client makes a request which is sent to a running process, and the results are sent back to the client.</p>
<p>For Interactive Content, RStudio Connect enables scaling through parameters that determine the content’s <a href="https://docs.rstudio.com/connect/admin/appendix-configuration.html#appendix-configuration-scheduler">scheduler</a>.</p>
<div id="content-scheduler" class="section level3">
<h3><span class="header-section-number">10.1.1</span> Content Scheduler</h3>
<p>When a user requests content with Shiny components, RStudio Connect opens a channel between the user and an R process. Now, suppose a second user requests the same content. There are two potential scenarios:</p>
<div class="figure">
<img src="imgs/scaling/scaling-a.png" alt="Scaling A" />
<p class="caption">Scaling A</p>
</div>
<p>In Scenario A, both users are linked to the same R process. Because R is single-threaded, if user A and user B both change an input and trigger R calculations, their requests will be handled sequentially. (User B will have to wait for user A’s calculation to complete, and then for their own calculation to complete before they will see an updated output).</p>
<div class="figure">
<img src="imgs/scaling/scaling-b.png" alt="Scaling B" />
<p class="caption">Scaling B</p>
</div>
<p>In Scenario B, Connect will link each user to their own R process. If user A and user B both change an input, their calculations will happen simultaneously.</p>
<p>Why wouldn’t RStudio Connect always select Scenario B? The answer has to do with memory and initial load time. When 2 users are connected to the same R process, they get to share everything that is loaded outside of the server function.</p>
<p>To see this, consider when the different pieces of Shiny application code are executed:</p>
<div class="figure">
<img src="imgs/scaling/app-execution.png" alt="App Execution" />
<p class="caption">App Execution</p>
</div>
<p>This works because Shiny makes use of R’s unique scoping rules (read more <a href="http://shiny.rstudio.com/articles/scoping.html">here</a>). In Scenario B, all of the shiny code has to be re-run, including loading any globally available data. This means the memory usage is 2x what it would be in Scenario A. Additionally, spinning up an R process and executing all of the shiny code takes time. While the application is more responsive to both users after the web page is loaded, it will take longer for them to connect initially.</p>
<p>The scheduling parameters tell RStudio Connect to act somewhere in between Scenario A and Scenario B, to maximize the trade-off between app responsiveness and memory consumption/load time. The parameters also specify how long R processes and user connections should remain idle before timing out.</p>
</div>
<div id="scheduling-parameters" class="section level3">
<h3><span class="header-section-number">10.1.2</span> Scheduling Parameters</h3>
<div class="figure">
<img src="imgs/scaling/rsc-runtime.png" alt="Runtime Settings Options" />
<p class="caption">Runtime Settings Options</p>
</div>
<p><strong>Max processes</strong> - Determines the maximum number of processes that will be created. Max processes x Max connections per process = total number of concurrent connections. Default value is 3.</p>
<p><em>Pick a value that will support the expected number of concurrent users or requests.</em></p>
<p><strong>Min processes</strong> - Determines the minimum number of processes that will always be running. For Shiny applications and plumber APIs, user requests only execute specific functions. R code outside of those functions can be run when the process starts before user requests are made, which can dramatically speed up response time.</p>
<p><em>Pick a number close to Max processes if your application or API pre-loads a large amount of data to be shared by every user. Pick a small number to minimize the amount of memory consumed.</em></p>
<p><strong>Max connections per process</strong> - The maximum number of connections per process. Default value is 20.</p>
<p><em>Pick a small number if your content involves heavy computation. Pick a larger number if your content shares data between users. (e.g. Pick a large number if your content takes a long time to load, but after loading is very fast.)</em></p>
<p><strong>Load factor</strong> - Determines how aggressively new processes will be created. A value close to 0 means new processes will be spun up aggressively to try and keep the number of connections per process small. A value close to 1 means the number of connections per process will be close to max connections. Default value is 0.5.</p>
<p><em>Pick a small number if your content loads quickly but involves expensive computation. Pick a number closer to 1 if your content loads slowly, but after loading is fast OR if you want to minimize the amount of memory.</em></p>
</div>
</div>
<div id="activity-runtime-settings" class="section level2">
<h2><span class="header-section-number">10.2</span> Activity: Runtime Settings</h2>
<p><strong>First: Open the runtime settings for your app</strong></p>
<p><strong>Discussion:</strong></p>
<ul>
<li>What do each of the settings mean?</li>
<li>What changes to the settings might affect our app?</li>
</ul>
<p><strong>Deliverable: Re-run Load Test</strong></p>
<p>Test your hypothesis by changing the runtime settings and then re-run the load test. Compare the results to the prior test (continue to follow along with <code>runloadtest.R</code>)</p>
</div>
<div id="activity-admin-dashboard" class="section level2">
<h2><span class="header-section-number">10.3</span> Activity: Admin Dashboard</h2>
<p><strong>First: Open the admin dashboard in RStudio Connect</strong></p>
<p><strong>Discussion:</strong></p>
<p><em>Multi-Tenant Environment</em></p>
<ul>
<li>What are the tradeoffs for modifying the scaling settings?</li>
<li>What else might you need to consider when sharing infrastructure?</li>
<li>How does these concerns change over time?</li>
</ul>
<p><strong>Deliverable: Update checklist</strong></p>
<p>Create one pre-deployment checklist step and one every-2-months checklist step based on your discussion.</p>
</div>
<div id="extended-topics-1" class="section level2">
<h2><span class="header-section-number">10.4</span> Extended Topics</h2>
<div id="high-availability-and-horizontal-scaling" class="section level3">
<h3><span class="header-section-number">10.4.1</span> High Availability and Horizontal Scaling</h3>
<p>Other considerations for widely accessed content are high availability and horizontal scaling. Both require content to be hosted by more than one server. RStudio Connect supports a <a href="https://docs.rstudio.com/connect/admin/high-availability.html">cluster setup</a>.</p>
</div>
<div id="r-markdown-documents-with-runtimeshiny" class="section level3">
<h3><span class="header-section-number">10.4.2</span> R Markdown Documents with runtime::shiny</h3>
<p>R Markdown documents are a bit different. In essence, an Rmd with runtime::shiny specified places everything (data loading, UI creation, etc) inside of the server function. The implication is an Rmd with runtime::shiny will always consume more memory as users connect.</p>
<p><a href="https://rmarkdown.rstudio.com/authoring_shiny_prerendered.html">Prerendered Shiny Documents</a> alleviate this problem.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="plot-caching.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="alternatives-to-shiny.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["spc-supplement.pdf", "spc-supplement.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
